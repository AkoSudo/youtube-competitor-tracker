---
phase: 04-polish
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - package.json
  - src/main.tsx
  - src/lib/vitals.ts
autonomous: false

must_haves:
  truths:
    - "Core Web Vitals are measured and logged"
    - "LCP, CLS, FCP, INP, TTFB metrics are captured"
    - "Performance meets targets on 3G throttled connection"
  artifacts:
    - path: "src/lib/vitals.ts"
      provides: "Web vitals reporting function"
      exports: ["reportWebVitals"]
    - path: "src/main.tsx"
      provides: "Calls reportWebVitals on app mount"
      contains: "reportWebVitals"
  key_links:
    - from: "src/main.tsx"
      to: "src/lib/vitals.ts"
      via: "import and call reportWebVitals"
      pattern: "import.*reportWebVitals"
---

<objective>
Add performance measurement and conduct final verification of polish requirements.

Purpose: Measure Core Web Vitals and verify all polish requirements are met.
Output: web-vitals integration and verified polish across all pages.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/04-polish/04-RESEARCH.md
@.planning/phases/04-polish/04-02-SUMMARY.md
@.planning/phases/04-polish/04-03-SUMMARY.md

@src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Web Vitals Measurement</name>
  <files>
    package.json
    src/lib/vitals.ts
    src/main.tsx
  </files>
  <action>
**Install web-vitals:**
```bash
npm install web-vitals
```

**Create src/lib/vitals.ts:**
```tsx
import { onCLS, onFCP, onLCP, onINP, onTTFB, type Metric } from 'web-vitals'

function logMetric(metric: Metric) {
  // Log to console in development
  console.log(`[Web Vitals] ${metric.name}:`, {
    value: metric.value,
    rating: metric.rating, // 'good' | 'needs-improvement' | 'poor'
    delta: metric.delta,
  })
}

export function reportWebVitals() {
  onCLS(logMetric)   // Cumulative Layout Shift
  onFCP(logMetric)   // First Contentful Paint
  onLCP(logMetric)   // Largest Contentful Paint
  onINP(logMetric)   // Interaction to Next Paint
  onTTFB(logMetric)  // Time to First Byte
}
```

**Update src/main.tsx:**
Add import and call after render:
```tsx
import { reportWebVitals } from './lib/vitals'

// After createRoot().render()
reportWebVitals()
```

This logs Core Web Vitals to console during development. In production, these could be sent to analytics.
  </action>
  <verify>
    - npm ls web-vitals shows installed version
    - src/lib/vitals.ts exists with reportWebVitals export
    - src/main.tsx imports and calls reportWebVitals
    - npm run build passes
    - Dev server shows Web Vitals logs in console
  </verify>
  <done>
    web-vitals installed and integrated; metrics log to console.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 4 Polish implementation:
- Skeleton loaders for channels, videos, and ideas
- EmptyState component used across pages
- Error boundary with fallback UI
- Web Vitals measurement

Requirements covered:
- REQ-UI-003: Loading skeleton states
- REQ-UI-005: Empty states with helpful messaging
- REQ-NFR-001: Page load < 3s on 3G
- REQ-NFR-002: TTI < 2s
- REQ-NFR-003: Real-time < 2s latency
  </what-built>
  <how-to-verify>
1. **Test skeleton loaders:**
   - Open DevTools > Network > Slow 3G throttling
   - Load http://localhost:5173 - should see channel skeleton grid
   - Click a channel - should see video skeleton grid
   - Navigate to Ideas - should see idea skeleton list

2. **Test empty states:**
   - If no channels exist, verify "No channels yet" message appears
   - If no ideas exist, verify "No ideas saved yet" message appears
   - On Ideas page, search for gibberish - verify "No ideas match" with clear button

3. **Test error boundary:**
   - This is harder to test manually, but verify App.tsx has ErrorBoundary wrapper

4. **Check Web Vitals:**
   - Open DevTools Console
   - Reload page
   - Look for [Web Vitals] logs with CLS, FCP, LCP, INP, TTFB
   - CLS should be < 0.1, FCP < 1.8s, LCP < 2.5s

5. **Performance check:**
   - Run Lighthouse in DevTools > Lighthouse
   - Check Performance score (should be > 80)
   - Verify LCP < 2.5s, CLS < 0.1

6. **Real-time verification:**
   - Open two tabs to same page
   - Add/delete a channel in one tab
   - Should appear in other tab within 2 seconds
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
- web-vitals package installed
- Metrics logging to console
- All skeleton components display during loading
- Empty states show appropriate messaging
- Error boundary catches unhandled errors
- Performance meets targets (Lighthouse > 80)
</verification>

<success_criteria>
- [ ] web-vitals installed and reporting to console
- [ ] CLS < 0.1 (no layout shift)
- [ ] LCP < 2.5s
- [ ] FCP < 1.8s
- [ ] Skeleton loaders appear on slow connection
- [ ] Empty states guide users appropriately
- [ ] Error boundary catches errors
- [ ] Real-time updates within 2s
- [ ] Overall Lighthouse Performance > 80
</success_criteria>

<output>
After completion, create `.planning/phases/04-polish/04-04-SUMMARY.md`
</output>
