---
phase: 07-video-analytics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useSessionState.ts
  - src/components/SortFilterControls.tsx
autonomous: true

must_haves:
  truths:
    - "useSessionState hook persists state to sessionStorage"
    - "SortFilterControls renders sort dropdown with Date/Views options"
    - "SortFilterControls renders direction toggle with arrow icons"
    - "SortFilterControls renders time period button group (7d/30d/90d/All)"
    - "Active time period button is visually highlighted"
  artifacts:
    - path: "src/hooks/useSessionState.ts"
      provides: "Session-persisted state hook"
      exports: ["useSessionState"]
    - path: "src/components/SortFilterControls.tsx"
      provides: "Sort and filter UI controls"
      exports: ["SortFilterControls"]
  key_links:
    - from: "src/hooks/useSessionState.ts"
      to: "sessionStorage"
      via: "getItem/setItem in useState initializer and useEffect"
      pattern: "sessionStorage\\.(get|set)Item"
    - from: "src/components/SortFilterControls.tsx"
      to: "props callbacks"
      via: "onChange handlers"
      pattern: "on(SortField|SortDirection|TimePeriod)Change"
---

<objective>
Create foundational components for video analytics filtering and sorting.

Purpose: Enable session-persisted sort/filter state and provide reusable UI controls that match the existing dark theme design system.

Output: Two new files - useSessionState hook for session persistence and SortFilterControls component for sort/filter UI.
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-video-analytics/07-RESEARCH.md
@src/pages/IdeasPage.tsx (filtering UI patterns - select dropdown, useMemo)
@src/lib/types.ts (existing type definitions)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useSessionState hook</name>
  <files>src/hooks/useSessionState.ts</files>
  <action>
Create a custom hook that syncs React state to sessionStorage.

Implementation details:
- Generic type parameter `T` for the state value
- Takes `key: string` and `defaultValue: T` parameters
- Returns `[T, React.Dispatch<React.SetStateAction<T>>]` (same signature as useState)
- Initialize state from sessionStorage if value exists, otherwise use defaultValue
- Sync state to sessionStorage in useEffect whenever state changes
- Wrap sessionStorage access in try/catch for SSR safety and private browsing mode
- Use JSON.parse/stringify for serialization

Key patterns from research:
```typescript
const [state, setState] = useState<T>(() => {
  if (typeof window === 'undefined') return defaultValue
  try {
    const stored = sessionStorage.getItem(key)
    return stored !== null ? (JSON.parse(stored) as T) : defaultValue
  } catch {
    return defaultValue
  }
})
```
  </action>
  <verify>File exists at src/hooks/useSessionState.ts with exported useSessionState function. TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>Hook exports useSessionState with correct typing, handles SSR and storage errors gracefully</done>
</task>

<task type="auto">
  <name>Task 2: Create SortFilterControls component</name>
  <files>src/components/SortFilterControls.tsx</files>
  <action>
Create a component that renders sort and time filter controls.

Type definitions (define at top of file):
```typescript
type SortField = 'published_at' | 'view_count'
type SortDirection = 'asc' | 'desc'
type TimePeriod = '7d' | '30d' | '90d' | 'all'
```

Props interface:
```typescript
interface SortFilterControlsProps {
  sortField: SortField
  sortDirection: SortDirection
  timePeriod: TimePeriod
  videoCount: number
  onSortFieldChange: (field: SortField) => void
  onSortDirectionChange: (dir: SortDirection) => void
  onTimePeriodChange: (period: TimePeriod) => void
}
```

Layout (flexbox with wrap, justify-between):
- Left side: "Sort by" label + select dropdown (Date/Views) + direction toggle button (arrow icon)
- Right side: Time period button group (7d | 30d | 90d | All time) + video count badge

Styling (match IdeasPage patterns):
- Select: `px-3 py-1.5 bg-[#272727] border border-[#3f3f3f] rounded-lg text-[#f1f1f1] text-sm`
- Direction button: `p-1.5 bg-[#272727] border border-[#3f3f3f] rounded-lg hover:bg-[#3f3f3f]`
- Time buttons: Container with `border border-[#3f3f3f] rounded-lg overflow-hidden`
- Active time button: `bg-[#3f3f3f] text-white`
- Inactive time button: `bg-[#272727] text-[#aaaaaa] hover:bg-[#3f3f3f] hover:text-white`
- Video count: `text-sm text-[#aaaaaa]`

Arrow icons (inline SVG):
- ArrowUpIcon: chevron pointing up (for ascending)
- ArrowDownIcon: chevron pointing down (for descending)
- Use `w-4 h-4` size, currentColor stroke

Requirements covered:
- SORT-01: Date option in dropdown
- SORT-02: Views option in dropdown
- SORT-03: Direction toggle button
- SORT-05: Current sort visually indicated (dropdown value + arrow direction)
- TIME-01: Four time period options
- TIME-04: Active period highlighted
  </action>
  <verify>File exists at src/components/SortFilterControls.tsx. TypeScript compiles: `npx tsc --noEmit`. Component exports SortFilterControls with correct props.</verify>
  <done>Component renders sort dropdown, direction toggle with arrow icons, time period button group with active state highlighting, and video count badge</done>
</task>

</tasks>

<verification>
1. Both files exist and TypeScript compiles: `npx tsc --noEmit`
2. useSessionState hook has correct function signature with generic type
3. SortFilterControls exports all expected types (SortField, SortDirection, TimePeriod)
4. Styling matches IdeasPage dark theme (#272727 backgrounds, #3f3f3f borders)
</verification>

<success_criteria>
- useSessionState hook syncs state to sessionStorage with SSR-safe implementation
- SortFilterControls renders all controls with proper dark theme styling
- TypeScript compiles without errors
- Components are ready for integration in Plan 07-02
</success_criteria>

<output>
After completion, create `.planning/phases/07-video-analytics/07-01-SUMMARY.md`
</output>
