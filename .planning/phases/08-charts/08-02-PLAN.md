---
phase: 08-charts
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/components/charts/UploadFrequencyChart.tsx
  - src/components/charts/DurationScatterChart.tsx
  - src/components/charts/index.ts
autonomous: true

must_haves:
  truths:
    - "User can view bar chart showing upload frequency by day of week"
    - "User can hover bar to see upload count for that day"
    - "User can view scatter plot of duration vs views"
    - "User can hover/tap scatter point to see video title and channel name"
    - "Scatter plot shows vertical line at average duration"
  artifacts:
    - path: "src/components/charts/UploadFrequencyChart.tsx"
      provides: "Day-of-week bar chart component"
      exports: ["UploadFrequencyChart"]
      min_lines: 50
    - path: "src/components/charts/DurationScatterChart.tsx"
      provides: "Duration vs views scatter chart"
      exports: ["DurationScatterChart"]
      min_lines: 70
    - path: "src/components/charts/index.ts"
      provides: "Barrel export for chart components"
      exports: ["UploadFrequencyChart", "DurationScatterChart"]
  key_links:
    - from: "src/components/charts/UploadFrequencyChart.tsx"
      to: "src/lib/chartUtils.ts"
      via: "transformToFrequencyData import"
      pattern: "import.*transformToFrequencyData"
    - from: "src/components/charts/DurationScatterChart.tsx"
      to: "src/lib/chartUtils.ts"
      via: "transformToScatterData import"
      pattern: "import.*transformToScatterData"
    - from: "src/components/charts/DurationScatterChart.tsx"
      to: "recharts"
      via: "ReferenceLine for average"
      pattern: "ReferenceLine"
---

<objective>
Create reusable chart components for upload frequency and duration analysis.

Purpose: Users need to visualize competitor upload patterns (which days they post) and understand duration vs performance relationships. These charts are the core deliverable of Phase 8.
Output: Two chart components with custom tooltips, dark theme styling, and responsive behavior.
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-charts/08-RESEARCH.md

@src/lib/chartUtils.ts
@src/lib/types.ts
@src/lib/formatters.ts
@src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UploadFrequencyChart component</name>
  <files>src/components/charts/UploadFrequencyChart.tsx</files>
  <action>
Create src/components/charts/UploadFrequencyChart.tsx:

**Props interface:**
```typescript
interface UploadFrequencyChartProps {
  videos: Video[]
}
```

**Implementation requirements:**

1. **ResponsiveContainer wrapper** (CRITICAL):
   - Wrap chart in `<div className="h-64 w-full">` - parent MUST have explicit height
   - Use `<ResponsiveContainer width="100%" height="100%">`

2. **BarChart with Recharts components:**
   - Import from 'recharts': ResponsiveContainer, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip
   - Use transformToFrequencyData from chartUtils
   - Apply accessibilityLayer prop to BarChart

3. **Styling with CSS variables:**
   - CartesianGrid: stroke="var(--color-chart-grid)", strokeDasharray="3 3", vertical={false}
   - XAxis: dataKey="day", tick fill="var(--color-text-secondary)", axisLine stroke="var(--color-chart-grid)"
   - YAxis: tick fill="var(--color-text-secondary)", axisLine stroke="var(--color-chart-grid)", allowDecimals={false}
   - Bar: dataKey="count", fill="var(--color-chart-primary)", radius={[4, 4, 0, 0]}

4. **Custom tooltip component (inline):**
   - Dark theme: bg-[#272727] border border-[#3f3f3f] rounded-lg p-3 shadow-lg
   - Show day name and count: "Monday: 12 uploads"
   - Return null if !active || !payload?.length

5. **Tooltip cursor styling:**
   - cursor={{ fill: 'var(--color-surface-hover)', opacity: 0.3 }}

Use useMemo for data transformation to avoid recalculating on every render.
  </action>
  <verify>
- File exists: `ls src/components/charts/UploadFrequencyChart.tsx`
- TypeScript compiles: `npx tsc --noEmit`
- Exports component: `grep "export function UploadFrequencyChart" src/components/charts/UploadFrequencyChart.tsx`
- Uses ResponsiveContainer: `grep "ResponsiveContainer" src/components/charts/UploadFrequencyChart.tsx`
  </verify>
  <done>UploadFrequencyChart renders bar chart with 7 day-of-week bars, custom tooltip, dark theme colors</done>
</task>

<task type="auto">
  <name>Task 2: Create DurationScatterChart component</name>
  <files>src/components/charts/DurationScatterChart.tsx, src/components/charts/index.ts</files>
  <action>
Create src/components/charts/DurationScatterChart.tsx:

**Props interface:**
```typescript
interface DurationScatterChartProps {
  videos: Video[]
  channelMap: Map<string, string>  // channelId -> channelName
}
```

**Implementation requirements:**

1. **ResponsiveContainer wrapper:**
   - Wrap in `<div className="h-80 w-full">` (taller than frequency chart for scatter readability)
   - Use ResponsiveContainer width="100%" height="100%"

2. **ScatterChart with Recharts components:**
   - Import: ResponsiveContainer, ScatterChart, Scatter, XAxis, YAxis, CartesianGrid, Tooltip, ReferenceLine, Label
   - Use transformToScatterData from chartUtils
   - Apply accessibilityLayer prop

3. **Axis configuration:**
   - XAxis: type="number", dataKey="duration", name="Duration", unit=" min"
   - YAxis: type="number", dataKey="views", tickFormatter using formatViewCount from formatters.ts
   - Both axes: tick fill="var(--color-text-secondary)", axisLine stroke="var(--color-chart-grid)"

4. **ReferenceLine for average duration (DURA-04):**
   - Calculate avgDuration in useMemo: sum of durations / count, rounded
   - ReferenceLine x={avgDuration} stroke="var(--color-chart-reference)" strokeDasharray="5 5"
   - Label inside ReferenceLine: value={`Avg: ${avgDuration} min`} position="top" fill="var(--color-text-secondary)" fontSize={12}
   - Handle empty data: if data.length === 0, don't render ReferenceLine

5. **Scatter element:**
   - data={data}, fill="var(--color-chart-primary)", fillOpacity={0.7}

6. **Custom tooltip (ScatterTooltip):**
   - Access data via payload[0].payload as ScatterData
   - Show video title (line-clamp-2), channel name, duration, views
   - Dark theme styling matching frequency tooltip
   - max-w-xs to prevent overflow on long titles

7. **Tooltip cursor:**
   - cursor={{ strokeDasharray: '3 3' }}

**Create barrel export src/components/charts/index.ts:**
```typescript
export { UploadFrequencyChart } from './UploadFrequencyChart'
export { DurationScatterChart } from './DurationScatterChart'
```
  </action>
  <verify>
- Files exist: `ls src/components/charts/DurationScatterChart.tsx src/components/charts/index.ts`
- TypeScript compiles: `npx tsc --noEmit`
- Has ReferenceLine: `grep "ReferenceLine" src/components/charts/DurationScatterChart.tsx`
- Barrel exports both: `grep -E "export.*from" src/components/charts/index.ts`
  </verify>
  <done>DurationScatterChart renders scatter plot with hover tooltip showing video details, ReferenceLine at average duration, barrel export created</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. Both components importable from 'src/components/charts'
3. Each chart has ResponsiveContainer with explicit parent height
4. Scatter chart has ReferenceLine for average indicator
5. Both tooltips use dark theme colors
</verification>

<success_criteria>
- UploadFrequencyChart renders 7-bar chart for day-of-week frequency
- DurationScatterChart renders scatter with hover details and average line
- Both charts use CSS variables for dark theme
- Both charts are responsive (ResponsiveContainer)
- Barrel export provides clean import path
</success_criteria>

<output>
After completion, create `.planning/phases/08-charts/08-02-SUMMARY.md`
</output>
