---
phase: 08-charts
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified:
  - src/pages/AnalyticsPage.tsx
autonomous: true

must_haves:
  truths:
    - "User can view upload frequency chart on Analytics page"
    - "User can toggle between all channels and single channel filter on frequency chart"
    - "User can view duration scatter chart on Analytics page"
    - "Charts filter data based on selected time period (7d, 30d, 90d, all)"
    - "Charts are readable on mobile (responsive)"
  artifacts:
    - path: "src/pages/AnalyticsPage.tsx"
      provides: "Charts section with frequency and scatter plots"
      contains: "UploadFrequencyChart"
      min_lines: 250
  key_links:
    - from: "src/pages/AnalyticsPage.tsx"
      to: "src/components/charts"
      via: "Chart component imports"
      pattern: "import.*from.*components/charts"
    - from: "src/pages/AnalyticsPage.tsx"
      to: "filteredAndSortedVideos"
      via: "Charts receive time-filtered data"
      pattern: "videos=.*filtered"
---

<objective>
Integrate chart components into the Analytics page with channel filtering.

Purpose: Charts need to be wired to the existing data flow (channels, videos, time period filter) and the upload frequency chart needs a channel selector for FREQ-03/FREQ-04 requirements.
Output: Analytics page displays both charts below the Channel Overview section, with functional channel filter on frequency chart.
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-charts/08-RESEARCH.md

@src/pages/AnalyticsPage.tsx
@src/components/charts/index.ts
@src/components/charts/UploadFrequencyChart.tsx
@src/components/charts/DurationScatterChart.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Charts section to AnalyticsPage with channel filter</name>
  <files>src/pages/AnalyticsPage.tsx</files>
  <action>
Modify src/pages/AnalyticsPage.tsx to add a Charts section:

**1. Add imports:**
```typescript
import { UploadFrequencyChart, DurationScatterChart } from '../components/charts'
```

**2. Add state for frequency chart channel filter:**
```typescript
const [frequencyChannelId, setFrequencyChannelId] = useState<string | null>(null)
```

**3. Add computed values (after existing filteredAndSortedVideos):**
```typescript
// Videos filtered by time period (for charts - uses same time filter as video grid)
const timeFilteredVideos = useMemo(() => {
  if (timePeriod === 'all') return videos
  const daysMap: Record<Exclude<TimePeriod, 'all'>, number> = {
    '7d': 7,
    '30d': 30,
    '90d': 90,
  }
  const cutoffDate = subDays(new Date(), daysMap[timePeriod])
  return videos.filter(video =>
    isAfter(new Date(video.published_at), cutoffDate)
  )
}, [videos, timePeriod])

// Videos for frequency chart (optionally filtered by channel)
const frequencyChartVideos = useMemo(() => {
  if (!frequencyChannelId) return timeFilteredVideos
  return timeFilteredVideos.filter(v => v.channel_id === frequencyChannelId)
}, [timeFilteredVideos, frequencyChannelId])

// Channel name map for scatter chart tooltips
const channelNameMap = useMemo(() => {
  const map = new Map<string, string>()
  for (const channel of channels) {
    map.set(channel.id, channel.name)
  }
  return map
}, [channels])
```

**4. Add Charts section in JSX (between Channel Overview and Videos sections):**
```tsx
{/* Charts Section */}
<section className="mb-8">
  <h2 className="text-lg font-semibold mb-4 text-[#aaaaaa]">Charts</h2>

  <div className="grid gap-6 lg:grid-cols-2">
    {/* Upload Frequency Chart */}
    <div className="bg-[#272727] rounded-lg p-4">
      <div className="flex items-center justify-between mb-4">
        <h3 className="font-medium">Upload Frequency by Day</h3>
        <select
          value={frequencyChannelId || ''}
          onChange={(e) => setFrequencyChannelId(e.target.value || null)}
          className="px-3 py-1.5 bg-[#0f0f0f] border border-[#3f3f3f] rounded-lg text-[#f1f1f1] text-sm"
        >
          <option value="">All channels</option>
          {channels.map(ch => (
            <option key={ch.id} value={ch.id}>{ch.name}</option>
          ))}
        </select>
      </div>
      <UploadFrequencyChart videos={frequencyChartVideos} />
    </div>

    {/* Duration vs Views Chart */}
    <div className="bg-[#272727] rounded-lg p-4">
      <h3 className="font-medium mb-4">Duration vs Views</h3>
      <DurationScatterChart
        videos={timeFilteredVideos}
        channelMap={channelNameMap}
      />
    </div>
  </div>
</section>
```

**5. Layout considerations:**
- Charts section appears between Channel Overview and Videos sections
- 2-column grid on lg screens, stacked on mobile (responsive - FREQ-05, DURA-05)
- Each chart in a card with bg-[#272727] for visual separation
- Channel selector uses same styling as other form elements in the app

**Note:** The time period filter (7d, 30d, 90d, all) already exists and will automatically filter chart data through the timeFilteredVideos computed value.
  </action>
  <verify>
- `npm run build` succeeds
- `grep "UploadFrequencyChart" src/pages/AnalyticsPage.tsx` shows import and usage
- `grep "DurationScatterChart" src/pages/AnalyticsPage.tsx` shows import and usage
- `grep "frequencyChannelId" src/pages/AnalyticsPage.tsx` shows channel filter state
- `grep "timeFilteredVideos" src/pages/AnalyticsPage.tsx` shows time-filtered data for charts
  </verify>
  <done>AnalyticsPage displays both charts with channel filter on frequency chart, charts respond to time period filter, 2-column responsive layout</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. Run `npm run dev` and navigate to /analytics:
   - Charts section visible below Channel Overview
   - Frequency bar chart shows 7 days with bars
   - Scatter plot shows dots with average line
   - Channel dropdown filters frequency chart
   - Time period buttons filter both charts
   - Charts stack vertically on narrow viewport
</verification>

<success_criteria>
- Upload frequency chart visible with channel selector dropdown
- "All channels" shows combined data, selecting channel filters to that channel only
- Duration scatter chart visible with average duration line
- Hover tooltips work on both charts
- Time period filter (7d, 30d, 90d, all) affects both charts
- Charts responsive: 2-column on desktop, stacked on mobile
</success_criteria>

<output>
After completion, create `.planning/phases/08-charts/08-03-SUMMARY.md`
</output>
