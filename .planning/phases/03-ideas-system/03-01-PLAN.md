---
phase: 03-ideas-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/003_create_ideas.sql
  - src/lib/types.ts
autonomous: true

must_haves:
  truths:
    - "Ideas table exists in database with correct schema"
    - "TypeScript types are available for ideas"
  artifacts:
    - path: "supabase/migrations/003_create_ideas.sql"
      provides: "Ideas table schema"
      contains: "CREATE TABLE IF NOT EXISTS ideas"
    - path: "src/lib/types.ts"
      provides: "Idea, IdeaInsert, IdeaWithVideo types"
      contains: "interface Idea"
  key_links:
    - from: "ideas table"
      to: "videos table"
      via: "video_id FK with ON DELETE CASCADE"
      pattern: "REFERENCES videos\\(id\\) ON DELETE CASCADE"
---

<objective>
Create the database foundation for the ideas system: migration for the ideas table and TypeScript type definitions.

Purpose: Establishes the data model for ideas management (REQ-DM-003). This is the foundation that all other ideas system plans depend on.

Output:
- SQL migration file for ideas table
- TypeScript types: Idea, IdeaInsert, IdeaWithVideo
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-ideas-system/03-RESEARCH.md

# Existing patterns to follow:
@supabase/migrations/002_create_videos.sql
@src/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ideas table migration</name>
  <files>supabase/migrations/003_create_ideas.sql</files>
  <action>
Create SQL migration for the ideas table following the pattern from 002_create_videos.sql:

**Schema (REQ-DM-003):**
- id: UUID PRIMARY KEY DEFAULT gen_random_uuid()
- video_id: UUID NOT NULL REFERENCES videos(id) ON DELETE CASCADE
- note: TEXT NOT NULL with CHECK constraint for min 10 characters
- added_by: TEXT NOT NULL (no auth in v1, user enters name)
- created_at: TIMESTAMPTZ NOT NULL DEFAULT NOW()

**Constraints:**
- Foreign key to videos with CASCADE delete (when video deleted, its ideas go too)
- CHECK constraint: char_length(note) >= 10

**Indexes:**
- ideas_video_id_idx on video_id (for lookup)
- ideas_added_by_idx on added_by (for "My Ideas" filter)
- ideas_created_at_idx on created_at DESC (for chronological listing)

**RLS Policies (public for v1):**
- SELECT: public can read all ideas
- INSERT: public can add ideas
- DELETE: public can delete ideas
- No UPDATE policy (ideas are immutable once saved)

Note: When a channel is deleted, its videos cascade delete, which cascades to ideas.
  </action>
  <verify>
Run `supabase db diff` to validate syntax, then apply migration:
```bash
cd supabase && supabase db push
```
Check the table exists with correct columns and constraints.
  </verify>
  <done>
- ideas table exists with all columns
- Foreign key constraint to videos is active
- CHECK constraint rejects notes < 10 chars
- RLS policies allow public access
  </done>
</task>

<task type="auto">
  <name>Task 2: Add TypeScript types for ideas</name>
  <files>src/lib/types.ts</files>
  <action>
Add three new type definitions to the existing types.ts file:

**Idea interface:**
```typescript
export interface Idea {
  id: string                    // UUID primary key
  video_id: string              // FK to videos.id
  note: string                  // User's note (min 10 chars)
  added_by: string              // User who saved the idea
  created_at: string            // ISO timestamp
}
```

**IdeaInsert interface:**
```typescript
export interface IdeaInsert {
  video_id: string
  note: string
  added_by: string
}
```

**IdeaWithVideo interface (for display with joined data):**
```typescript
export interface IdeaWithVideo extends Idea {
  video: {
    id: string
    youtube_id: string
    title: string
    thumbnail_url: string
    channel: {
      id: string
      name: string
    }
  }
}
```

Add these after the existing Video/VideoInsert types to maintain logical grouping.
  </action>
  <verify>
```bash
npx tsc --noEmit
```
No type errors should appear.
  </verify>
  <done>
- Idea, IdeaInsert, IdeaWithVideo types exported from types.ts
- TypeScript compiles without errors
- Types match database schema from migration
  </done>
</task>

</tasks>

<verification>
1. Migration applied successfully: `supabase db push` completes without error
2. Types compile: `npx tsc --noEmit` passes
3. Database constraint works: Attempting to insert an idea with < 10 char note fails
</verification>

<success_criteria>
- ideas table created in Supabase with correct schema
- Foreign key cascade works (deleting video deletes its ideas)
- TypeScript types match database schema
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-ideas-system/03-01-SUMMARY.md`
</output>
