---
phase: 03-ideas-system
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/components/SaveIdeaModal.tsx
  - src/pages/ChannelDetailPage.tsx
autonomous: true

must_haves:
  truths:
    - "User can click Save Idea on a video and see a modal"
    - "Modal shows video thumbnail and title (read-only)"
    - "User can enter a note (min 10 chars) and their name"
    - "Saving an idea closes modal and shows success toast"
  artifacts:
    - path: "src/components/SaveIdeaModal.tsx"
      provides: "Modal for saving ideas with note and added_by fields"
      exports: ["SaveIdeaModal", "SaveIdeaModalRef"]
    - path: "src/pages/ChannelDetailPage.tsx"
      provides: "Integration of SaveIdeaModal with VideoGrid"
      contains: "SaveIdeaModal"
  key_links:
    - from: "ChannelDetailPage.tsx"
      to: "SaveIdeaModal"
      via: "ref.current.open(video)"
      pattern: "modalRef\\.current\\?.open"
    - from: "SaveIdeaModal"
      to: "useIdeas.addIdea"
      via: "onSave callback"
      pattern: "onSave.*video"
---

<objective>
Create the Save Idea modal and wire it to the existing VideoCard's "Save Idea" button.

Purpose: Implements REQ-IDX-001 - the ability to save ideas with notes from any video. The modal follows the existing ConfirmDialog pattern using native dialog element.

Output:
- SaveIdeaModal component with video preview, note textarea, added_by input
- ChannelDetailPage updated to use the modal
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-ideas-system/03-RESEARCH.md

# Existing patterns to follow:
@src/components/ConfirmDialog.tsx
@src/pages/ChannelDetailPage.tsx
@src/components/VideoCard.tsx
@src/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SaveIdeaModal component</name>
  <files>src/components/SaveIdeaModal.tsx</files>
  <action>
Create SaveIdeaModal.tsx using native dialog element, following ConfirmDialog pattern:

**Exports:**
```typescript
export interface SaveIdeaModalRef {
  open: (video: Video) => void
  close: () => void
}

export interface SaveIdeaModalProps {
  onSave: (videoId: string, note: string, addedBy: string) => Promise<{ success: boolean; error?: string }>
}
```

**Component structure:**
- Use forwardRef with useImperativeHandle (like ConfirmDialog)
- dialogRef for native dialog element
- Local state: video (Video | null), note (string), addedBy (string), isSubmitting (boolean), error (string | null)

**open(video) method:**
- Set video state
- Pre-fill addedBy from localStorage: `localStorage.getItem('youtubeTracker_userName') || ''`
- Clear note and error
- Call dialogRef.current?.showModal()

**close() method:**
- Call dialogRef.current?.close()

**Form layout (REQ-IDX-001):**
1. Video preview section (read-only):
   - Thumbnail image (aspect-video, max-w-xs, rounded)
   - Video title below thumbnail (truncated to 2 lines)

2. Note textarea:
   - Label: "Your idea note"
   - Placeholder: "What makes this video interesting? (min 10 characters)"
   - min 10 chars validation (show inline error if < 10 on blur or submit)
   - 4 rows, full width, dark theme styling

3. Added by input:
   - Label: "Your name"
   - Placeholder: "Enter your name"
   - Required, persist to localStorage on successful save

4. Buttons (right-aligned):
   - Cancel (secondary style, calls close())
   - Save Idea (primary blue, disabled if note < 10 or addedBy empty or isSubmitting)

**Submit handler:**
- Validate note.length >= 10 and addedBy not empty
- Set isSubmitting true
- Call onSave(video.id, note.trim(), addedBy.trim())
- On success: Save addedBy to localStorage, close modal
- On error: Show error in modal, keep open

**Styling:** Match ConfirmDialog dark theme - bg-[#272727], text-[#f1f1f1], inputs bg-[#1f1f1f]
  </action>
  <verify>
```bash
npx tsc --noEmit
```
Component compiles. Visually verify by temporarily rendering in ChannelDetailPage.
  </verify>
  <done>
- SaveIdeaModal renders video preview, note textarea, added_by input
- Note validation enforces 10+ characters
- addedBy persists to/from localStorage
- Modal opens/closes via ref methods
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire SaveIdeaModal to ChannelDetailPage</name>
  <files>src/pages/ChannelDetailPage.tsx</files>
  <action>
Update ChannelDetailPage to use the SaveIdeaModal:

**Imports:**
```typescript
import { SaveIdeaModal, type SaveIdeaModalRef } from '../components/SaveIdeaModal'
import { useIdeas } from '../hooks/useIdeas'
```

**Add ref and hook:**
```typescript
const modalRef = useRef<SaveIdeaModalRef>(null)
const { addIdea } = useIdeas()
```

**Update handleSaveIdea:**
```typescript
const handleSaveIdea = (video: Video) => {
  modalRef.current?.open(video)
}
```

**Create handleSaveIdeaSubmit callback:**
```typescript
const handleSaveIdeaSubmit = async (videoId: string, note: string, addedBy: string) => {
  const result = await addIdea({ video_id: videoId, note, added_by: addedBy })
  if (result.success) {
    toast.success('Idea saved!')
  } else {
    toast.error(result.error || 'Failed to save idea')
  }
  return result
}
```

**Render modal:**
Add SaveIdeaModal at end of component, before closing div:
```tsx
<SaveIdeaModal
  ref={modalRef}
  onSave={handleSaveIdeaSubmit}
/>
```

Remove the temporary toast.info('Save Idea feature coming in Phase 3!') - it's now functional.
  </action>
  <verify>
1. Run app: `npm run dev`
2. Navigate to a channel with videos
3. Click "Save Idea" on any video
4. Modal should open showing video thumbnail and title
5. Enter note (10+ chars) and name
6. Click Save - should close modal and show success toast
  </verify>
  <done>
- Clicking "Save Idea" on VideoCard opens SaveIdeaModal
- Modal displays selected video's thumbnail and title
- Saving creates idea in database
- Success toast appears on save
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Modal opens when clicking Save Idea button
3. Modal shows video thumbnail and title
4. Cannot save with note < 10 chars (validation message)
5. Successful save closes modal and shows toast
6. Added_by name persists in localStorage for next save
</verification>

<success_criteria>
- SaveIdeaModal component follows ConfirmDialog pattern
- Video preview shows in modal (thumbnail + title)
- Note validation requires 10+ characters
- User name persists across saves via localStorage
- Integration with ChannelDetailPage complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-ideas-system/03-03-SUMMARY.md`
</output>
