---
phase: 03-ideas-system
plan: 04
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/components/IdeaCard.tsx
  - src/pages/IdeasPage.tsx
  - src/components/Nav.tsx
autonomous: true

must_haves:
  truths:
    - "Ideas page shows all saved ideas in chronological order"
    - "Each idea shows note, video thumbnail/title, channel name, added_by, timestamp"
    - "User can delete an idea with confirmation"
    - "User can filter ideas by channel"
    - "User can search ideas by note or video title"
    - "My Ideas toggle filters to current user's ideas"
    - "Nav badge shows idea count"
  artifacts:
    - path: "src/components/IdeaCard.tsx"
      provides: "Display component for individual idea"
      exports: ["IdeaCard"]
    - path: "src/pages/IdeasPage.tsx"
      provides: "Full ideas page with filtering and list"
      contains: "useIdeas"
    - path: "src/components/Nav.tsx"
      provides: "Navigation with ideas count badge"
      contains: "ideas"
  key_links:
    - from: "IdeasPage"
      to: "useIdeas"
      via: "hook for data and actions"
      pattern: "useIdeas\\(\\)"
    - from: "IdeasPage"
      to: "IdeaCard"
      via: "renders list of ideas"
      pattern: "IdeaCard.*idea="
---

<objective>
Build the Ideas page with IdeaCard component, filtering (channel, search, My Ideas), and delete functionality.

Purpose: Implements REQ-IDX-002 through REQ-IDX-008 - the complete ideas viewing experience with filtering and deletion.

Output:
- IdeaCard component for displaying individual ideas
- IdeasPage with full filtering (channel, search, My Ideas)
- Nav updated with ideas count badge
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-ideas-system/03-RESEARCH.md

# Existing patterns:
@src/components/ChannelCard.tsx
@src/components/ConfirmDialog.tsx
@src/pages/ChannelsPage.tsx
@src/components/Nav.tsx
@src/lib/formatters.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create IdeaCard component</name>
  <files>src/components/IdeaCard.tsx</files>
  <action>
Create IdeaCard.tsx for displaying a single idea (REQ-IDX-003):

**Props:**
```typescript
interface IdeaCardProps {
  idea: IdeaWithVideo
  onDelete?: (id: string) => void
}
```

**Layout (horizontal card):**
```
+------------------+-------------------------------------------+
| Video Thumbnail  | Note text (full, not truncated)           |
| (120x68 or so)   |                                           |
|                  | Video: {title} | Channel: {name}          |
| [Click to open   | Added by {added_by} â€¢ {relative date}     |
|  YouTube]        |                               [Delete btn]|
+------------------+-------------------------------------------+
```

**Implementation details:**
- Left: Video thumbnail (aspect-video, ~120px wide, rounded, link to YouTube)
- Right: Content area with:
  - Note text (full text, preserve whitespace with whitespace-pre-wrap)
  - Video info: "Video: {title}" truncated, link to YouTube
  - Channel name: "Channel: {name}"
  - Footer: "Added by {added_by}" + relative date (use formatRelativeDate) + Delete button

**Delete button:**
- Red text, appears on right side of footer
- Icon: trash can SVG
- Calls onDelete(idea.id) when clicked

**Styling:**
- Card: bg-[#272727] rounded-xl p-4
- Note: text-[#f1f1f1]
- Meta info: text-sm text-[#aaaaaa]
- Hover state: slightly lighter background

**Accessibility:**
- Video thumbnail link has aria-label
- Delete button has aria-label "Delete idea"
  </action>
  <verify>
```bash
npx tsc --noEmit
```
Component compiles.
  </verify>
  <done>
- IdeaCard displays note, video info, channel, author, date
- Thumbnail links to YouTube video
- Delete button visible and clickable
  </done>
</task>

<task type="auto">
  <name>Task 2: Build complete IdeasPage with filtering</name>
  <files>src/pages/IdeasPage.tsx, src/components/Nav.tsx</files>
  <action>
**Part A: Rebuild IdeasPage.tsx with full functionality:**

**Imports:**
- useIdeas hook
- IdeaCard component
- ConfirmDialog for delete confirmation
- useState, useMemo, useRef for state and filtering
- toast from sonner

**State:**
```typescript
const { ideas, isLoading, error, deleteIdea } = useIdeas()
const [searchQuery, setSearchQuery] = useState('')
const [channelFilter, setChannelFilter] = useState('')
const [myIdeasOnly, setMyIdeasOnly] = useState(false)
const deleteDialogRef = useRef<ConfirmDialogRef>(null)
const [ideaToDelete, setIdeaToDelete] = useState<string | null>(null)
```

**Custom useDebounce hook (inline or separate file):**
```typescript
function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState(value)
  useEffect(() => {
    const timer = setTimeout(() => setDebouncedValue(value), delay)
    return () => clearTimeout(timer)
  }, [value, delay])
  return debouncedValue
}
```

**Filtering logic (REQ-IDX-006, REQ-IDX-007, REQ-IDX-008):**
```typescript
const debouncedSearch = useDebounce(searchQuery, 300)
const currentUser = localStorage.getItem('youtubeTracker_userName') || ''

// Get unique channels that have ideas (REQ-IDX-007)
const channelsWithIdeas = useMemo(() => {
  const channelMap = new Map<string, { id: string; name: string }>()
  ideas.forEach(idea => {
    const ch = idea.video.channel
    if (!channelMap.has(ch.id)) {
      channelMap.set(ch.id, ch)
    }
  })
  return Array.from(channelMap.values())
}, [ideas])

// Apply all filters
const filteredIdeas = useMemo(() => {
  return ideas.filter(idea => {
    // Search filter (note and video title)
    if (debouncedSearch) {
      const search = debouncedSearch.toLowerCase()
      const matchesNote = idea.note.toLowerCase().includes(search)
      const matchesTitle = idea.video.title.toLowerCase().includes(search)
      if (!matchesNote && !matchesTitle) return false
    }
    // Channel filter
    if (channelFilter && idea.video.channel.id !== channelFilter) return false
    // My ideas filter
    if (myIdeasOnly && idea.added_by !== currentUser) return false
    return true
  })
}, [ideas, debouncedSearch, channelFilter, myIdeasOnly, currentUser])
```

**Delete flow:**
```typescript
const handleDeleteClick = (id: string) => {
  setIdeaToDelete(id)
  deleteDialogRef.current?.open()
}

const handleConfirmDelete = async () => {
  if (!ideaToDelete) return
  const result = await deleteIdea(ideaToDelete)
  if (result.success) {
    toast.success('Idea deleted')
  } else {
    toast.error(result.error || 'Failed to delete idea')
  }
  setIdeaToDelete(null)
}
```

**Layout:**
```
Header: "Ideas" title + count badge
Filters row: Search input | Channel dropdown | My Ideas toggle
Ideas list: IdeaCard for each filtered idea (or empty state)
ConfirmDialog for delete
```

**Filter controls:**
- Search: input type="text" with search icon, placeholder "Search ideas..."
- Channel dropdown: native select with "All Channels" default + channelsWithIdeas options
- My Ideas: checkbox or toggle switch, label "My Ideas"

**Empty states:**
- No ideas at all: "No ideas saved yet. Browse channel videos and save ideas you like."
- No results from filter: "No ideas match your filters."

**Loading state:**
- Show skeleton cards (3-4) while isLoading

**Part B: Update Nav.tsx with ideas count badge:**

Add ideas count to the Ideas nav link. Two approaches:
1. Pass count as prop from App.tsx (requires lifting state)
2. Use a simple fetch in Nav (simpler for now)

**Simpler approach - use a separate small hook or inline effect:**
Since we don't want to call useIdeas in Nav (would duplicate subscription), just show static text "Ideas" for now, OR:

Add a simple count fetch on mount:
```typescript
const [ideaCount, setIdeaCount] = useState<number>(0)
useEffect(() => {
  supabase.from('ideas').select('id', { count: 'exact', head: true })
    .then(({ count }) => setIdeaCount(count || 0))
}, [])
```

Display badge next to "Ideas" link when count > 0:
```tsx
<Link to="/ideas">
  Ideas
  {ideaCount > 0 && (
    <span className="ml-2 bg-red-600 text-white text-xs px-1.5 py-0.5 rounded-full">
      {ideaCount}
    </span>
  )}
</Link>
```

Real-time updates for badge: For v1, static count on load is acceptable. Full real-time badge would require more infrastructure.
  </action>
  <verify>
1. Run app: `npm run dev`
2. Navigate to Ideas page
3. See empty state if no ideas
4. Save an idea from channel page, return to Ideas - idea appears
5. Test search: type in search box, list filters
6. Test channel filter: select a channel, only that channel's ideas show
7. Test My Ideas: toggle on, only your ideas show
8. Test delete: click delete, confirm, idea removed
  </verify>
  <done>
- Ideas page shows all ideas in chronological order
- Search filters by note and video title
- Channel dropdown filters by source channel
- My Ideas toggle shows only current user's ideas
- Delete with confirmation works
- Nav shows ideas count badge
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Ideas page loads and shows ideas or empty state
3. All three filters work correctly (search, channel, My Ideas)
4. Delete flow works with confirmation dialog
5. Nav badge updates when ideas exist
6. Real-time: teammate adding idea appears in list with toast
</verification>

<success_criteria>
- IdeaCard displays all required information
- IdeasPage implements all filtering requirements
- Delete works with confirmation
- Search debounces (300ms delay)
- Channel filter shows only channels with ideas
- My Ideas toggle uses localStorage username
- Nav badge shows idea count
</success_criteria>

<output>
After completion, create `.planning/phases/03-ideas-system/03-04-SUMMARY.md`
</output>
