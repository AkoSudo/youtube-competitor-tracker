---
phase: 09-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/usePrefersReducedMotion.ts
  - src/components/DataFreshnessIndicator.tsx
autonomous: true

must_haves:
  truths:
    - "usePrefersReducedMotion hook detects user motion preference"
    - "Hook updates when user toggles system preference"
    - "DataFreshnessIndicator displays relative timestamp"
  artifacts:
    - path: "src/hooks/usePrefersReducedMotion.ts"
      provides: "Motion preference detection hook"
      exports: ["usePrefersReducedMotion"]
      min_lines: 15
    - path: "src/components/DataFreshnessIndicator.tsx"
      provides: "Freshness indicator UI component"
      exports: ["DataFreshnessIndicator"]
      min_lines: 20
  key_links:
    - from: "src/hooks/usePrefersReducedMotion.ts"
      to: "window.matchMedia"
      via: "prefers-reduced-motion media query"
      pattern: "matchMedia.*prefers-reduced-motion"
    - from: "src/components/DataFreshnessIndicator.tsx"
      to: "date-fns"
      via: "formatDistanceToNow import"
      pattern: "formatDistanceToNow"
---

<objective>
Create foundation components for Phase 9 polish features: a usePrefersReducedMotion hook for accessibility and a DataFreshnessIndicator component for data trust.

Purpose: These reusable utilities enable the chart polish work in Plan 02. The hook detects user motion preferences for controlling Recharts animations, and the indicator shows when data was last fetched.

Output:
- src/hooks/usePrefersReducedMotion.ts - Hook that returns boolean for reduced motion preference
- src/components/DataFreshnessIndicator.tsx - Component displaying "Updated X ago" with clock icon
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-polish/09-RESEARCH.md

# Existing hooks for pattern reference
@src/hooks/useSessionState.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create usePrefersReducedMotion hook</name>
  <files>src/hooks/usePrefersReducedMotion.ts</files>
  <action>
Create a React hook that detects user's motion preference using `window.matchMedia('(prefers-reduced-motion: reduce)')`.

Implementation details:
1. Import useState and useEffect from React
2. Define QUERY constant: '(prefers-reduced-motion: reduce)'
3. Initialize state to `true` (animations disabled) for SSR safety - this prevents hydration mismatch
4. In useEffect:
   - Get mediaQuery via window.matchMedia(QUERY)
   - Set initial state from mediaQuery.matches
   - Add event listener for 'change' events to update state when user toggles system preference
   - Return cleanup function that removes event listener
5. Return the boolean state (true = user prefers reduced motion)

Why default to true: Server-rendered HTML won't match client if we default to false and then user has reduced motion enabled. Defaulting to true (no animations) is safe for both cases.

Export: Named export `usePrefersReducedMotion`
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/thihaaung/Library/Mobile\ Documents/com~apple~CloudDocs/YoutubeTracker && npx tsc --noEmit
```
  </verify>
  <done>
- Hook file exists at src/hooks/usePrefersReducedMotion.ts
- Exports usePrefersReducedMotion function
- Uses window.matchMedia with prefers-reduced-motion query
- Has cleanup function for event listener
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DataFreshnessIndicator component</name>
  <files>src/components/DataFreshnessIndicator.tsx</files>
  <action>
Create a component that displays when data was last fetched using a clock icon and relative time.

Implementation details:
1. Import formatDistanceToNow from 'date-fns'
2. Define props interface:
   - lastFetchedAt: Date | string (accepts both formats)
   - className?: string (for positioning flexibility)
3. Inside component:
   - Convert string to Date if needed: `typeof lastFetchedAt === 'string' ? new Date(lastFetchedAt) : lastFetchedAt`
   - Use formatDistanceToNow(timestamp, { addSuffix: true }) for "5 minutes ago" format
4. Render:
   - Flex container with gap-2, text-xs, text-[#aaaaaa]
   - Clock SVG icon (w-4 h-4): use path `M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z`
   - Span with "Updated {relativeTime}"
5. Accept className prop and merge with base classes

Styling: Match existing design system - muted text (#aaaaaa), small size (text-xs), subtle clock icon.

Export: Named export `DataFreshnessIndicator`
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/thihaaung/Library/Mobile\ Documents/com~apple~CloudDocs/YoutubeTracker && npx tsc --noEmit
```
  </verify>
  <done>
- Component file exists at src/components/DataFreshnessIndicator.tsx
- Exports DataFreshnessIndicator function
- Uses formatDistanceToNow from date-fns
- Displays clock icon and relative timestamp
- Accepts lastFetchedAt prop (Date or string)
- TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. TypeScript compiles: `npx tsc --noEmit` - no errors
2. Files exist:
   - src/hooks/usePrefersReducedMotion.ts
   - src/components/DataFreshnessIndicator.tsx
3. Exports are correct (can be imported in other files)
</verification>

<success_criteria>
- usePrefersReducedMotion hook created with media query listener
- DataFreshnessIndicator component created with clock icon and relative time
- Both files compile without TypeScript errors
- Ready for integration in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/09-polish/09-01-SUMMARY.md`
</output>
