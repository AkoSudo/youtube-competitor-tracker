---
phase: 09-polish
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/charts/UploadFrequencyChart.tsx
  - src/components/charts/DurationScatterChart.tsx
  - src/pages/AnalyticsPage.tsx
autonomous: true

must_haves:
  truths:
    - "Charts display axis labels describing what each axis represents"
    - "Empty video arrays show helpful messaging instead of blank charts"
    - "All-zero data (filtered period) shows period-specific messaging"
    - "Chart animations disabled when user prefers reduced motion"
    - "Data freshness indicator shows when videos were last fetched"
  artifacts:
    - path: "src/components/charts/UploadFrequencyChart.tsx"
      provides: "Polished bar chart with labels, empty states, motion control"
      contains: "Label"
      min_lines: 80
    - path: "src/components/charts/DurationScatterChart.tsx"
      provides: "Polished scatter chart with labels, empty states, motion control"
      contains: "Label"
      min_lines: 100
    - path: "src/pages/AnalyticsPage.tsx"
      provides: "Analytics page with freshness indicator"
      contains: "DataFreshnessIndicator"
  key_links:
    - from: "src/components/charts/UploadFrequencyChart.tsx"
      to: "usePrefersReducedMotion"
      via: "hook import and isAnimationActive prop"
      pattern: "isAnimationActive=\\{!prefersReducedMotion\\}"
    - from: "src/components/charts/DurationScatterChart.tsx"
      to: "usePrefersReducedMotion"
      via: "hook import and isAnimationActive prop"
      pattern: "isAnimationActive=\\{!prefersReducedMotion\\}"
    - from: "src/pages/AnalyticsPage.tsx"
      to: "DataFreshnessIndicator"
      via: "component import and render with timestamp"
      pattern: "videosFetchedAt"
---

<objective>
Polish both chart components with axis labels, empty states, and motion preference support. Integrate the DataFreshnessIndicator into AnalyticsPage.

Purpose: Complete all POLI-* requirements for production-ready analytics charts with proper accessibility and user trust features.

Output:
- Polished UploadFrequencyChart with axis labels, empty states, motion control
- Polished DurationScatterChart with axis labels, empty states, motion control
- AnalyticsPage with data freshness indicator showing last fetch time
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-polish/09-RESEARCH.md
@.planning/phases/09-polish/09-01-SUMMARY.md

# Files being modified
@src/components/charts/UploadFrequencyChart.tsx
@src/components/charts/DurationScatterChart.tsx
@src/pages/AnalyticsPage.tsx

# Created in Plan 01
@src/hooks/usePrefersReducedMotion.ts
@src/components/DataFreshnessIndicator.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Polish UploadFrequencyChart with labels, empty states, motion</name>
  <files>src/components/charts/UploadFrequencyChart.tsx</files>
  <action>
Update UploadFrequencyChart to add axis labels, empty states, and motion preference support.

1. Add imports:
   - `Label` from 'recharts' (add to existing import)
   - `usePrefersReducedMotion` from '../../hooks/usePrefersReducedMotion'

2. Inside component, add hook call:
   ```typescript
   const prefersReducedMotion = usePrefersReducedMotion()
   ```

3. Add empty state handling BEFORE the chart render:
   ```typescript
   // Empty state - no videos at all
   if (videos.length === 0) {
     return (
       <div className="h-64 w-full flex flex-col items-center justify-center text-center p-6">
         <svg className="w-12 h-12 text-[#aaaaaa] mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
           <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5}
             d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
         </svg>
         <p className="text-[#f1f1f1] font-medium mb-1">No upload data</p>
         <p className="text-[#aaaaaa] text-sm">
           Add channels and fetch videos to see upload frequency
         </p>
       </div>
     )
   }

   // All-zero data (filtered by time period)
   const hasNonZeroData = data.some(d => d.count > 0)
   if (!hasNonZeroData) {
     return (
       <div className="h-64 w-full flex flex-col items-center justify-center text-center p-6">
         <p className="text-[#f1f1f1] font-medium mb-1">No uploads in this period</p>
         <p className="text-[#aaaaaa] text-sm">Try selecting a longer time range</p>
       </div>
     )
   }
   ```

4. Update BarChart to add margin for labels:
   ```typescript
   <BarChart data={data} accessibilityLayer margin={{ bottom: 20, left: 10 }}>
   ```

5. Add Label to XAxis (as child element):
   ```typescript
   <XAxis ...existing props>
     <Label value="Day of Week" position="insideBottom" offset={-10} fill="var(--color-text-secondary)" fontSize={12} />
   </XAxis>
   ```

6. Add Label to YAxis (as child element):
   ```typescript
   <YAxis ...existing props>
     <Label value="Uploads" angle={-90} position="insideLeft" fill="var(--color-text-secondary)" fontSize={12} />
   </YAxis>
   ```

7. Add motion control to Bar:
   ```typescript
   <Bar
     dataKey="count"
     fill="var(--color-chart-primary)"
     radius={[4, 4, 0, 0]}
     isAnimationActive={!prefersReducedMotion}
     animationDuration={300}
   />
   ```

Important: Keep existing tooltip functionality unchanged.
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/thihaaung/Library/Mobile\ Documents/com~apple~CloudDocs/YoutubeTracker && npx tsc --noEmit
```
  </verify>
  <done>
- UploadFrequencyChart has XAxis Label "Day of Week"
- UploadFrequencyChart has YAxis Label "Uploads"
- Empty video array shows "No upload data" message
- All-zero data shows "No uploads in this period" message
- Bar has isAnimationActive tied to motion preference
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Polish DurationScatterChart with labels, empty states, motion</name>
  <files>src/components/charts/DurationScatterChart.tsx</files>
  <action>
Update DurationScatterChart to add axis labels, empty states, and motion preference support.

1. Add imports:
   - `Label` from 'recharts' (add to existing import)
   - `usePrefersReducedMotion` from '../../hooks/usePrefersReducedMotion'

2. Inside component, add hook call:
   ```typescript
   const prefersReducedMotion = usePrefersReducedMotion()
   ```

3. Add empty state handling BEFORE the chart render (after avgDuration useMemo):
   ```typescript
   // Empty state - no videos
   if (videos.length === 0) {
     return (
       <div className="h-80 w-full flex flex-col items-center justify-center text-center p-6">
         <svg className="w-12 h-12 text-[#aaaaaa] mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
           <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5}
             d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
         </svg>
         <p className="text-[#f1f1f1] font-medium mb-1">No video data</p>
         <p className="text-[#aaaaaa] text-sm">
           Add channels and fetch videos to see duration vs views analysis
         </p>
       </div>
     )
   }
   ```

4. Update ScatterChart to add margin for labels:
   ```typescript
   <ScatterChart accessibilityLayer margin={{ bottom: 25, left: 60, right: 20 }}>
   ```

5. Add Label to XAxis (as child element):
   ```typescript
   <XAxis ...existing props>
     <Label value="Video Duration (minutes)" position="insideBottom" offset={-15} fill="var(--color-text-secondary)" fontSize={12} />
   </XAxis>
   ```

6. Add Label to YAxis (as child element):
   ```typescript
   <YAxis ...existing props>
     <Label value="View Count" angle={-90} position="insideLeft" offset={-5} fill="var(--color-text-secondary)" fontSize={12} />
   </YAxis>
   ```

7. Add motion control to Scatter:
   ```typescript
   <Scatter
     data={data}
     fill="var(--color-chart-primary)"
     fillOpacity={0.7}
     isAnimationActive={!prefersReducedMotion}
     animationDuration={300}
   />
   ```

Important: Keep existing tooltip and ReferenceLine functionality unchanged.
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/thihaaung/Library/Mobile\ Documents/com~apple~CloudDocs/YoutubeTracker && npx tsc --noEmit
```
  </verify>
  <done>
- DurationScatterChart has XAxis Label "Video Duration (minutes)"
- DurationScatterChart has YAxis Label "View Count"
- Empty video array shows "No video data" message with scatter icon
- Scatter has isAnimationActive tied to motion preference
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate DataFreshnessIndicator into AnalyticsPage</name>
  <files>src/pages/AnalyticsPage.tsx</files>
  <action>
Update AnalyticsPage to track when videos were fetched and display the freshness indicator.

1. Add import at top:
   ```typescript
   import { DataFreshnessIndicator } from '../components/DataFreshnessIndicator'
   ```

2. Add state for tracking fetch time (near other useState calls):
   ```typescript
   const [videosFetchedAt, setVideosFetchedAt] = useState<Date | null>(null)
   ```

3. Update the fetchAllVideos effect to track fetch time:
   After `setVideos(data || [])`, add:
   ```typescript
   setVideosFetchedAt(new Date())
   ```

4. Add DataFreshnessIndicator to the Charts section header:
   Find the line:
   ```typescript
   <h2 className="text-lg font-semibold mb-4 text-[#aaaaaa]">Charts</h2>
   ```

   Replace with:
   ```typescript
   <div className="flex items-center justify-between mb-4">
     <h2 className="text-lg font-semibold text-[#aaaaaa]">Charts</h2>
     {videosFetchedAt && !videosLoading && (
       <DataFreshnessIndicator lastFetchedAt={videosFetchedAt} />
     )}
   </div>
   ```

Important: Only show the indicator when videos have been fetched (not null) and loading is complete.
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/thihaaung/Library/Mobile\ Documents/com~apple~CloudDocs/YoutubeTracker && npx tsc --noEmit
```

Dev server starts without errors:
```bash
cd /Users/thihaaung/Library/Mobile\ Documents/com~apple~CloudDocs/YoutubeTracker && timeout 10 npm run dev 2>&1 | head -20 || true
```
  </verify>
  <done>
- AnalyticsPage imports DataFreshnessIndicator
- videosFetchedAt state tracks when videos were fetched
- DataFreshnessIndicator renders in Charts section header
- Indicator only shows when videos loaded (not during loading state)
- TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. TypeScript compiles: `npx tsc --noEmit` - no errors
2. Dev server starts: `npm run dev` - no errors
3. Visual verification (manual):
   - Charts show axis labels
   - Empty charts show helpful messages
   - "Updated X ago" appears near Charts heading
   - Animations respect system motion preference (if testable)
</verification>

<success_criteria>
- POLI-01: Both charts have axis labels (Day of Week/Uploads, Video Duration/View Count)
- POLI-02: DataFreshnessIndicator shows "Updated X ago" in Charts section
- POLI-03: Empty states show context-specific messaging (no data vs filtered period)
- POLI-04: Chart animations controlled by usePrefersReducedMotion hook
- All files compile without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-polish/09-02-SUMMARY.md`
</output>
